<!-- books per genre graph-->
<div class="fluid-container">
    <div class="row">
        <div class="col-12">
            <div class="section-title text-center">
                <h2>Our Genres</h2>
                <img alt="" src="/images/section-title.png">
            </div>
        </div>
    </div>
    <div class="row mt-4">
        <div class="col-md-12 text-center">
            <div class="section-text">
                <p>Welcome to LibroRed - Your Community Book Sharing Platform</p>
                <p>Discover, share, and enjoy books with our community. Browse our collection or sign up to start lending and borrowing books.</p>
            </div>
        </div>
    </div>
</div>


<!-- Books Collection Section -->
<div class="container mt-5">
    <div class="row">
        <div class="col-12">
            <div class="section-title text-center">
                <h2>Our Book Collection</h2>
                <img alt="" src="/images/section-title.png">
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div *ngIf="loading" class="text-center mt-4">
        <div class="spinner-border" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <p>Loading books...</p>
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="alert alert-danger mt-4" role="alert">
        {{ errorMessage }}
        <button type="button" class="btn btn-link" (click)="loadBooks()">Try Again</button>
    </div>

    <!-- Books Grid -->
    <div *ngIf="!loading && !errorMessage" class="row mt-4">
        <div *ngFor="let book of books" class="col-md-3 col-sm-6 mb-4">
            <div class="card h-100 shadow-sm">
                <img [src]="getImageUrl(book)" class="card-img-top" [alt]="book.title"
                     style="height: 260px; width: 260px; object-fit: cover; background-color: #f8f9fa; margin: 0 auto; display: block;">

                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">{{ book.title }}</h5>
                    <p class="card-text"><strong>Author:</strong> {{ book.author }}</p>
                    <p class="card-text"><strong>Genre:</strong> {{ book.genre | titlecase }}</p>
                    <p class="card-text flex-grow-1">{{ book.description }}</p>

                    <!-- Owner Info -->
                    <div class="mt-auto">
                        <small class="text-muted">
                            <strong>Owner:</strong> {{ book.owner?.username || 'Unknown' }}
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <!-- No Books Message -->
        <div *ngIf="books.length === 0 && !loading" class="col-12">
            <div class="alert alert-info text-center">
                <h5>No Books Available</h5>
                <p>There are no books in the collection yet.</p>
                <a routerLink="/register" class="btn btn-primary">Join to Add Books</a>
            </div>
        </div>
    </div>

    <!-- Load More Section -->
    <div *ngIf="books.length > 0" class="row mt-4">
        <div class="col-12 text-center">
            <!-- Load More Button -->
            <button
                *ngIf="hasMorePages && !loadingMore"
                class="btn btn-outline-danger loadmore-btn"
                (click)="loadMoreBooks()">
                Load More
            </button>

            <!-- Loading More Spinner -->
            <div *ngIf="loadingMore" class="d-inline-block">
                <div class="spinner-border spinner-border-sm text-danger me-2" role="status">
                    <span class="sr-only">Loading...</span>
                </div>
                <span>Loading more books...</span>
            </div>

            <!-- No More Books Message -->
            <div *ngIf="!hasMorePages && books.length > 0" class="text-muted">
                <small>All books loaded ({{ books.length }} of {{ books.length }} books)</small>
            </div>
        </div>
    </div>
</div>